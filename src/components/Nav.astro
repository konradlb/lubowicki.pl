---
import Icon from './Icon.astro'; // Assuming Icon.astro exists and works as previously discussed

interface Props {
  pathname: string;
}

const { pathname } = Astro.props;

const navItems = [
    { path: '/', label: { pl: '~/blog', en: '~/blog' }, icon: 'terminal' },
    { path: '/projects', label: { pl: './projekty', en: './projects' }, icon: 'folderGit2' },
    { path: '/uses', label: { pl: '/uses', en: '/uses' }, icon: 'cpu' },
    { path: '/about', label: { pl: 'whoami', en: 'whoami' }, icon: 'user' },
  ];

const isActive = (path: string) => {
    if (path === '/') {
      return pathname === '/';
    }
    return pathname.startsWith(path);
};
---

<nav class="navbar">
    <div class="navbar-container">
        
        {/* Logo */}
        <a href="/" class="logo-link">
            <div class="logo-box">
              <span class="logo-cursor" />
            </div>
            <span class="logo-text">dev@matrix:~$</span>
        </a>

        {/* Desktop Menu */}
        <div class="desktop-menu">
            <div class="nav-links">
              {navItems.map((item) => (
                <a
                  key={item.path}
                  href={item.path}
                  class:list={["nav-item", { "active": isActive(item.path) }]}
                >
                  <Icon name={item.icon} size="16" class="nav-icon" />
                  {item.label['pl']} {/* Hardcoding 'pl' for now, will be dynamic */}
                </a>
              ))}
            </div>
            {/* Simplified LanguageSwitcher */}
            <div class="language-switcher">
                <button id="lang-pl" class="lang-btn active">PL</button>
                <button id="lang-en" class="lang-btn">EN</button>
            </div>
        </div>

        {/* Mobile menu button */}
        <div class="mobile-toggle">
            <button id="menu-btn" class="menu-btn">
                <Icon name="menu" size="24" class="menu-icon" />
                <Icon name="x" size="24" class="x-icon hidden" />
            </button>
        </div>
    </div>

</nav>

{/* Mobile Menu (now a sibling of navbar) */}
<div id="mobile-menu" class="mobile-menu hidden">
    {navItems.map((item) => (
        <a
          key={item.path}
          href={item.path}
          class:list={["mobile-nav-item", { "active": isActive(item.path) }]}
        >
            <div class="mobile-nav-content">
                <Icon name={item.icon} size="16" style={{ marginRight: '0.75rem' }} />
                {item.label['pl']} {/* Hardcoding 'pl' for now, will be dynamic */}
            </div>
        </a>
    ))}
     {/* Simplified LanguageSwitcher for mobile */}
     <div class="language-switcher-mobile">
        <button id="lang-pl-mobile" class="lang-btn active">PL</button>
        <button id="lang-en-mobile" class="lang-btn">EN</button>
    </div>
</div>

<style>
    /* Use the same styles as in the React component, ensuring global CSS variables are used */
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        background-color: var(--color-bg-dim);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        border-bottom: 1px solid var(--color-dim);
        height: var(--header-height);
    }

    .navbar-container {
        max-width: var(--container-width);
        margin: 0 auto;
        padding: 0 var(--spacing-md);
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
    }

    /* Logo Styles */
    .logo-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--color-matrix);
        font-weight: bold;
        transition: color 0.2s;
        text-decoration: none;
    }
    .logo-link:hover {
        color: var(--color-white);
    }
    .logo-box {
        border: 2px solid var(--color-matrix);
        padding: 2px;
        transition: border-color 0.2s;
    }
    .logo-link:hover .logo-box {
        border-color: var(--color-white);
    }
    .logo-cursor {
        display: block;
        width: 8px;
        height: 8px;
        background-color: var(--color-matrix);
        animation: blink 1.5s infinite;
    }
    .logo-link:hover .logo-cursor {
        background-color: var(--color-white);
    }
    .logo-text {
        letter-spacing: 0.05em;
    }

    /* Desktop Menu */
    .desktop-menu {
        display: none;
        align-items: center;
        gap: 2rem;
    }
    .nav-links {
        display: flex;
        gap: 1rem;
    }
    .nav-item {
        display: flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--color-dim);
        transition: all 0.2s;
        border-radius: 2px;
        text-decoration: none;
    }
    .nav-item:hover {
        color: var(--color-matrix);
        background-color: rgba(0, 143, 17, 0.1);
    }
    .nav-item.active {
        color: var(--color-bg);
        background-color: var(--color-matrix);
    }
    .nav-icon {
        margin-right: 0.5rem;
    }

    /* Language Switcher */
    .language-switcher, .language-switcher-mobile {
        display: flex;
        gap: 0.5rem;
    }
    .lang-btn {
        background: none;
        border: 1px solid var(--color-dim);
        color: var(--color-dim);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
    }
    .lang-btn:hover {
        border-color: var(--color-matrix);
        color: var(--color-matrix);
    }
    .lang-btn.active {
        background-color: var(--color-matrix);
        color: var(--color-bg);
        border-color: var(--color-matrix);
    }


    /* Mobile Menu Button */
    .mobile-toggle {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .menu-btn {
        background: none;
        border: none;
        color: var(--color-matrix);
        cursor: pointer;
        padding: 0.5rem;
    }
    .menu-btn:hover {
        color: var(--color-white);
    }

    /* Mobile Menu Dropdown */
    .mobile-menu {
        display: block;
        background-color: var(--color-bg); /* Use opaque background */
        backdrop-filter: none; /* Unset inherited backdrop-filter */
        -webkit-backdrop-filter: none; /* Unset for webkit */
        border-bottom: 1px solid var(--color-dim);
        padding: 0.5rem;
        position: fixed; /* Changed to fixed */
        width: 100%;
        top: var(--header-height); /* Position it right below the fixed navbar */
        left: 0; /* Align with the left edge of the navbar */
        right: 0; /* Make it span full width */
        bottom: 0; /* Extend to bottom of viewport */
        z-index: 999; /* Very high z-index to be on top */
        overflow-y: auto; /* Allow scrolling if content is long */
    }
    .mobile-nav-item {
        display: block;
        padding: 0.75rem;
        font-size: 1rem;
        font-weight: 500;
        color: var(--color-dim);
        margin-bottom: 2px;
        text-decoration: none;
    }
    .mobile-nav-item.active {
        background-color: var(--color-matrix);
        color: var(--color-bg);
    }
    .mobile-nav-content {
        display: flex;
        align-items: center;
    }
    .hidden {
        display: none;
    }

    @media (min-width: 768px) {
        .desktop-menu { display: flex; }
        .logo-text { display: block; }
        .mobile-toggle { display: none; }
        .mobile-menu { display: none; }
        .language-switcher-mobile { display: none; }
    }
    @media (max-width: 767px) {
        .logo-text { display: none; }
        .language-switcher { display: none; }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileNavItems = document.querySelectorAll('#mobile-menu .mobile-nav-item');
        const langPlBtn = document.getElementById('lang-pl');
        const langEnBtn = document.getElementById('lang-en');
        const langPlMobileBtn = document.getElementById('lang-pl-mobile');
        const langEnMobileBtn = document.getElementById('lang-en-mobile');

        const menuIcon = document.querySelector('.menu-icon');
        const xIcon = document.querySelector('.x-icon');

        let isMobileMenuOpen = false;
        let currentLanguage = 'pl'; // Default language

        const updateMobileMenu = () => {
            if (mobileMenu) {
                if (isMobileMenuOpen) {
                    mobileMenu.classList.remove('hidden');
                } else {
                    mobileMenu.classList.add('hidden');
                }
                // Update menu icon based on state
                if (menuIcon && xIcon) {
                    if (isMobileMenuOpen) {
                        menuIcon.classList.add('hidden');
                        xIcon.classList.remove('hidden');
                    } else {
                        menuIcon.classList.remove('hidden');
                        xIcon.classList.add('hidden');
                    }
                }
            }
        };

        const updateLanguageButtons = () => {
            [langPlBtn, langPlMobileBtn].forEach(btn => {
                if (btn) btn.classList.toggle('active', currentLanguage === 'pl');
            });
            [langEnBtn, langEnMobileBtn].forEach(btn => {
                if (btn) btn.classList.toggle('active', currentLanguage === 'en');
            });
            // Here you would also update the displayed labels for navItems
            // This would require re-rendering or direct DOM manipulation of text content
            // For now, we'll keep the labels static as per the requirement "Docelowo użyję Nano Stores"
        };


        if (menuBtn) {
            menuBtn.addEventListener('click', () => {
                isMobileMenuOpen = !isMobileMenuOpen;
                updateMobileMenu();
            });
        }

        mobileNavItems.forEach(item => {
            item.addEventListener('click', () => {
                isMobileMenuOpen = false;
                updateMobileMenu();
            });
        });

        // Language switcher logic
        if (langPlBtn) {
            langPlBtn.addEventListener('click', () => { currentLanguage = 'pl'; updateLanguageButtons(); });
        }
        if (langEnBtn) {
            langEnBtn.addEventListener('click', () => { currentLanguage = 'en'; updateLanguageButtons(); });
        }
        if (langPlMobileBtn) {
            langPlMobileBtn.addEventListener('click', () => { currentLanguage = 'pl'; updateLanguageButtons(); });
        }
        if (langEnMobileBtn) {
            langEnMobileBtn.addEventListener('click', () => { currentLanguage = 'en'; updateLanguageButtons(); });
        }

        updateLanguageButtons(); // Set initial active state for language buttons
    });
</script>